<!DOCTYPE html>
<html lang="de">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Quelltext-Contentelemente für TYPO3 Neos</title>
  <meta name="description" content="Eines der Features von TYPO3 Neos, das mich am meisten begeistert, ist die Anpassungsfähigkeit des Systems. Für diese Seite brauchte ich die Möglichkeit, Que...">

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.9/css/all.css" integrity="sha384-5SOiIsAziJl6AWe0HWRKTXlfcSHKmYV4RBF18PPJ173Kzn7jzMyFuTtk8JA7QQG1" crossorigin="anonymous">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.5.0/css/mdb.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/fonts.css">

  <link rel="canonical" href="https://www.martin-helmich.de/de/blog/quelltext-content-in-neos.html">

  <link rel="alternate" type="application/rss+xml" title="martin-helmich.de" href="https://www.martin-helmich.de/feed.xml">

  
    <link rel="alternate" hreflang="en" href="/en/blog/source-code-content-in-neos.html">
  

</head>


  <body>

    <div class="main">
      <div  class="blog-landing" style="background-image: url(/assets/headers/neos-sourcecode.jpg)">
      <nav class="navbar navbar-expand-lg navbar-dark elegant-color">
  <div class="container">
    <a class="navbar-brand" href="/">martin-helmich.de</a>

    <!-- Collapse button -->
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="basicExampleNav"
        aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse">
      <ul class="navbar-nav mr-auto">
        
          
          
          <li class="nav-item normal">
            <a class="nav-link" href="/">Blog</a>
          </li>
        
          
          
          <li class="nav-item normal">
            <a class="nav-link" href="/de/ueber-mich.html">Über mich</a>
          </li>
        
          
          
          <li class="nav-item normal">
            <a class="nav-link" href="/de/veroeffentlichungen.html">Veröffentlichungen</a>
          </li>
        
      </ul>

      
      <ul class="navbar-nav navbar-right">
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">
            Deutsch
            <span class="caret"></span>
          </a>
          <div class="dropdown-menu dropdown-primary">
            <a class="active dropdown-item" href="/de/blog/quelltext-content-in-neos.html">Deutsch</a>
            <a class="normal dropdown-item" href="/en/blog/source-code-content-in-neos.html">Englisch</a>
          </div>
        </li>
      </ul>
      
    </div>
  </div>
</nav>


        <div class="container attribution">
          
          CC BY-SA, Martin Helmich
          
        </div>
      </div>

      <div class="container primary">
        <div class="content main-content">
          <div class="post-content">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <p class="post-meta text-center font-italic">
      Geschrieben am
      
      <time datetime="2015-04-13T19:42:28+00:00" itemprop="datePublished">
        13. April 2015
      </time>
      

      
    </p>

    
      <div class="my-alert row info-color-dark white-text z-depth-1">
      <div class="col-sm-12">
        <span class="icon">
          <i class="fa fa-globe"></i>
        </span>
        <div class="my-alert-body">
          <strong>Hello! </strong> 
        This article is also <a href="/en/blog/source-code-content-in-neos.html">available in English</a>!
      
        </div>
      </div>
    </div>
    

    <h1 class="post-title" itemprop="name headline">Quelltext-Contentelemente für TYPO3 Neos</h1>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Eines der Features von TYPO3 Neos, das mich am meisten begeistert, ist die Anpassungsfähigkeit des Systems. Für diese Seite brauchte ich die Möglichkeit, Quelltextbeispiele mit Syntaxhervorhebung darstellen zu können. Glücklicherweise ist so etwas in Neos überhaupt kein Problem; daher beschreibe ich heute, wie ihr in TYPO3 Neos einen eigenen NodeType hinzufügen könnt, der euch ein Content-Element mit Quelltext und Syntax-Hervorhebung in eure Neos-Seite rendert.</p>

<p>Ich setze an dieser Stelle voraus, dass ihr euch mit den Grundlagen von TYPO3 Neos auskennt, und insbesondere wisst</p>

<ul>
  <li>mit welchen Paketstrukturen Neos arbeitet und wo grob welche Dateien liegen</li>
  <li>wie Inhalt in Neos strukturiert ist und dass es so etwas wie ein Content Repository gibt</li>
  <li>wie ihr eigene NodeTypes erstellen könnt</li>
</ul>

<h2 id="nodetypes-definieren">NodeTypes definieren</h2>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="code"><pre><span class="s1">'</span><span class="s">Helmich.Homepage:SourceCode'</span><span class="pi">:</span>
  <span class="na">superTypes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">TYPO3.Neos:Content'</span>
  <span class="na">ui</span><span class="pi">:</span>
    <span class="na">group</span><span class="pi">:</span> <span class="s">general</span>
    <span class="na">label</span><span class="pi">:</span> <span class="s">Source code</span>
    <span class="na">icon</span><span class="pi">:</span> <span class="s">icon-code</span>
    <span class="na">inspector</span><span class="pi">:</span>
      <span class="na">groups</span><span class="pi">:</span>
        <span class="na">code</span><span class="pi">:</span>
          <span class="na">label</span><span class="pi">:</span> <span class="s">Code</span>
  <span class="na">properties</span><span class="pi">:</span>
    <span class="na">content</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="na">ui</span><span class="pi">:</span>
        <span class="na">label</span><span class="pi">:</span> <span class="s">Code</span>
        <span class="na">reloadIfChanged</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">inspector</span><span class="pi">:</span>
          <span class="na">group</span><span class="pi">:</span> <span class="s">code</span>
          <span class="na">position</span><span class="pi">:</span> <span class="m">80</span>
          <span class="na">editor</span><span class="pi">:</span> <span class="s1">'</span><span class="s">TYPO3.Neos/Inspector/Editors/CodeEditor'</span>
          <span class="na">editorOptions</span><span class="pi">:</span>
            <span class="na">buttonLabel</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Edit</span><span class="nv"> </span><span class="s">source</span><span class="nv"> </span><span class="s">code'</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Das von Neos gewohnte Inline-Editing können wir hier leider nicht nutzen, da sich der Aloha-Editor nicht mit den &lt;pre&gt;-Tags verträgt, in die der Content später hineingerendert wird. Das macht aber nichts, denn genau für diesen Zweck bietet Neos bereits einen Code-Editor für den Inspektor an, der hier in Zeile 21 aktiviert wird. Auf diese Weise bekommt ihr später im Backend zur Bearbeitung des Quelltextes einen entsprechenden Editor mit Syntax-Hervorhebung bereitgestellt.</p>

<h2 id="das-fluid-template">Das Fluid-Template</h2>

<p>Als nächstes wird nun das Fluid-Template für den NodeType definiert. Das ist keine große Raketentechnik, da wir den Quelltext ja eigentlich nur wieder so ausgeben möchten, wie er eingegeben wurde. Standardmäßig wird das Template in eurem Paket unter <code class="language-plaintext highlighter-rouge">Resources/Private/Templates/NodeTypes/SourceCode.html</code> gesucht. Das könnte man über TypoScript überschreiben; dazu besteht hier jedoch kein Anlass:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">{namespace neos=TYPO3\Neos\ViewHelpers}
{namespace media=TYPO3\Media\ViewHelpers}

<span class="nt">&lt;pre</span> <span class="na">class=</span><span class="s">"prettyprint"</span><span class="nt">&gt;&lt;code&gt;</span>{node.properties.content}<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span></code></pre></figure>

<p>Das schaut ja noch recht überschaubar aus, oder? An diesem Zeitpunkt könnt ihr jetzt bereits Quelltextelemente über das Neos-Backend erstellen. Ihr habt jedoch noch keine Syntax-Hervorhebung oder den ganzen anderen Schnickschnack. Das gehen wir nun als nächstes an.</p>

<h2 id="syntax-highlighting-konfigurieren">Syntax-Highlighting konfigurieren</h2>

<p>Für das Syntax-Highlighting nutze ich in diesem Beispiel die <a href="https://code.google.com/p/google-code-prettify/">Prettify-Bibliothek</a> von Google. Diese hat den Vorteil, dass sie rein JavaScript-seitig arbeitet, und ihr euch im PHP-Backend nicht um die Darstellung des Quelltextes zu kümmern braucht. Die Bibliothek besteht aus einigen JavaScript- und CSS-Dateien, die ihr am besten alle in das Resources/Public-Verzeichnis eures Pakets werft (bei mir liegt alles unter Resources/Public/Libraries/Prettify).</p>

<p>Die Bibliothek muss nun noch eingebunden werden; am einfachsten geht das im Seiten-Template:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
{namespace neos=TYPO3\Neos\ViewHelpers}
{namespace ts=TYPO3\TypoScript\ViewHelpers}
{namespace tbs=TYPO3\Twitter\Bootstrap\ViewHelpers}
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;f:section</span> <span class="na">name=</span><span class="s">"stylesheets"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- Put your stylesheet inclusions here, they will be included in your website by TypoScript --&gt;</span>
    <span class="nt">&lt;/f:section&gt;</span>
    <span class="nt">&lt;f:section</span> <span class="na">name=</span><span class="s">"headScripts"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span>
                <span class="na">src=</span><span class="s">"{f:uri.resource(path:'Libraries/Prettify/run_prettify.js', package: 'Helmich.Homepage')}?skin=desert"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/f:section&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h2 id="mehr-konfigurationsmöglichkeiten">Mehr Konfigurationsmöglichkeiten</h2>

<p>Im nächsten Schritt soll das Inhaltselement nun noch ein wenig konfigurierbarer werden. So funktioniert beispielsweise die automatische Spracherkennung von Prettify nicht besonders gut, daher wäre eine Möglichkeit sinnvoll, die gewählte Programmiersprache direkt angeben zu können. Außerdem wäre es schön, die Zeilennummerierungen ein- und ausschalten zu können.</p>

<p>Für beide Konfigurationen könnt ihr die ursprüngliche Definition des NodeTypes erweitern:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td><td class="code"><pre><span class="s1">'</span><span class="s">Helmich.Homepage:SourceCode'</span><span class="pi">:</span>
  <span class="na">superTypes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">TYPO3.Neos:Content'</span>
  <span class="na">ui</span><span class="pi">:</span>
    <span class="na">group</span><span class="pi">:</span> <span class="s">general</span>
    <span class="na">label</span><span class="pi">:</span> <span class="s">Source code</span>
    <span class="na">icon</span><span class="pi">:</span> <span class="s">icon-code</span>
    <span class="na">inspector</span><span class="pi">:</span>
      <span class="na">groups</span><span class="pi">:</span>
        <span class="na">code</span><span class="pi">:</span>
          <span class="na">label</span><span class="pi">:</span> <span class="s">Code</span>
  <span class="na">properties</span><span class="pi">:</span>
    <span class="na">content</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="na">ui</span><span class="pi">:</span>
        <span class="na">label</span><span class="pi">:</span> <span class="s">Code</span>
        <span class="na">reloadIfChanged</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">inspector</span><span class="pi">:</span>
          <span class="na">group</span><span class="pi">:</span> <span class="s">code</span>
          <span class="na">position</span><span class="pi">:</span> <span class="m">80</span>
          <span class="na">editor</span><span class="pi">:</span> <span class="s1">'</span><span class="s">TYPO3.Neos/Inspector/Editors/CodeEditor'</span>
          <span class="na">editorOptions</span><span class="pi">:</span>
            <span class="na">buttonLabel</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Edit</span><span class="nv"> </span><span class="s">source</span><span class="nv"> </span><span class="s">code'</span>
    <span class="na">lineNumbers</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
      <span class="na">defaultValue</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">ui</span><span class="pi">:</span>
        <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Enable</span><span class="nv"> </span><span class="s">line</span><span class="nv"> </span><span class="s">numbering'</span>
        <span class="na">reloadIfChanged</span><span class="pi">:</span> <span class="s">TRUE</span>
        <span class="na">inspector</span><span class="pi">:</span>
          <span class="na">group</span><span class="pi">:</span> <span class="s1">'</span><span class="s">code'</span>
          <span class="na">position</span><span class="pi">:</span> <span class="m">60</span>
    <span class="na">language</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="na">defaultValue</span><span class="pi">:</span> <span class="s1">'</span><span class="s">auto'</span>
      <span class="na">ui</span><span class="pi">:</span>
        <span class="na">reloadIfChanged</span><span class="pi">:</span> <span class="s">TRUE</span>
        <span class="na">inspector</span><span class="pi">:</span>
          <span class="na">group</span><span class="pi">:</span> <span class="s">code</span>
          <span class="na">position</span><span class="pi">:</span> <span class="m">50</span>
          <span class="na">editor</span><span class="pi">:</span> <span class="s1">'</span><span class="s">TYPO3.Neos/Inspector/Editors/SelectBoxEditor'</span>
          <span class="na">editorOptions</span><span class="pi">:</span>
            <span class="na">values</span><span class="pi">:</span>
              <span class="s1">'</span><span class="s">auto'</span><span class="pi">:</span>
                <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Determine</span><span class="nv"> </span><span class="s">automatically'</span>
              <span class="s1">'</span><span class="s">html'</span><span class="pi">:</span>
                <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">HTML'</span>
              <span class="s1">'</span><span class="s">php'</span><span class="pi">:</span>
                <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">PHP'</span>
              <span class="s1">'</span><span class="s">xml'</span><span class="pi">:</span>
                <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">XML'</span>
              <span class="s1">'</span><span class="s">yaml'</span><span class="pi">:</span>
                <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">YAML'</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Die Auswertung dieser Optionen könnt ihr am einfachen in TypoScript machen. Der Standard-Einstiegspunkt ist dabei die Datei <code class="language-plaintext highlighter-rouge">Root.ts2</code>, die standardmäßig unter <code class="language-plaintext highlighter-rouge">Resources/Private/TypoScript</code> gesucht wird:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>prototype(Helmich.Homepage:SourceCode) {
  attributes.class = 'prettyprint'
  attributes.class.@process {
    language {
      expression = ${value + (q(node).property('language') != 'auto' ? ' lang-' + q(node).property('language') : '')}
    }

    lineNumbering {
      expression = ${value + (q(node).property('lineNumbers') ? ' linenums' : '')}
    }
  }
}
</pre></td></tr></tbody></table></code></pre></figure>

<p>Um die in TypoScript konfigurierten Attribute nun auch im Template nutzen zu können, müsst ihr noch kurz das Fluid-Template anpassen:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre>{namespace neos=TYPO3\Neos\ViewHelpers}
{namespace media=TYPO3\Media\ViewHelpers}

<span class="nt">&lt;pre</span> <span class="err">{</span><span class="na">attributes</span> <span class="na">-</span><span class="nt">&gt;</span> f:format.raw()}&gt;<span class="nt">&lt;code&gt;</span>{node.properties.content}<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</pre></td></tr></tbody></table></code></pre></figure>


  </div>

  <h2 id="comments">Kommentare</h2>

  <div id="disqus_thread"  class="helmich-homepage-blogarticle"></div>
</article>
<script type="text/javascript">
var disqus_config = function () {
    this.page.url = "https://www.martin-helmich.de/de/blog/quelltext-content-in-neos.html";
    this.page.identifier = "0b5a5243-9c0e-b5dd-c9ce-80da73c3f781";
    this.page.title = "Quelltext-Contentelemente für TYPO3 Neos";
};

(function() {  // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    
    s.src = 'https://martinhelmichde.disqus.com/embed.js';
    
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script>
<noscript>
Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments
powered by Disqus.</a>
</noscript>
</div>
        </div>
      </div>
    </div>

    

<footer class="page-footer font-small stylish-color pt-4 z-depth-1">
  <div class="container">
    <div class="row">
      <div class="col-sm-4">
        <h5>Veröffentlichungen</h5>
        <ul>
          
          
            <li>
              <strong><a href="/de/veroeffentlichungen.html">Rust: Ein Blick auf die C/C++-Alternative</a></strong>
              am 25. Mai 2022
            </li>
          
            <li>
              <strong><a href="/de/veroeffentlichungen.html">Event-Sourcing: Das steckt hinter dem Software-Kontenbuch</a></strong>
              am 14. Februar 2021
            </li>
          
            <li>
              <strong><a href="/de/veroeffentlichungen.html">Praxiswissen TYPO3 CMS 10</a></strong>
              am 04. Dezember 2020
            </li>
          
            <li>
              <strong><a href="/de/veroeffentlichungen.html">Rust: Ein Blick auf die C/C++-Alternative</a></strong>
              am 01. Juli 2020
            </li>
          
            <li>
              <strong><a href="/de/veroeffentlichungen.html">Microservices: Mit Tools wie Jaeger die Übersicht behalten</a></strong>
              am 01. April 2020
            </li>
          
        </ul>
      </div>
      <div class="col-sm-4">
        <h5>
          Blog-Artikel
        </h5>
        <ul>
          
          
            <li>
              <strong><a href="/https:/t3n.de/magazin/event-sourcing-das-steckt-hinter-250347/">Event-Sourcing: Das steckt hinter dem Software-Kontenbuch</a></strong>
              am 14. Februar 2021
            </li>
          
            <li>
              <strong><a href="/https:/t3n.de/magazin/microservices-mit-tools-wie-die-249408/">Microservices: Mit Tools wie Jaeger die Übersicht behalten</a></strong>
              am 04. Juli 2020
            </li>
          
            <li>
              <strong><a href="/https:/jaxenter.de/kubernetes/automatisierung-kubernetes-operators-88189">Automatisierung mit Kubernetes Operators</a></strong>
              am 04. Februar 2020
            </li>
          
            <li>
              <strong><a href="/https:/t3n.de/magazin/besser-entwickeln-mit-continuous-247076/">Besser entwickeln mit Devops-Praktiken: Continuous Delivery mit Kubernetes</a></strong>
              am 07. April 2019
            </li>
          
            <li>
              <strong><a href="/de/blog/typo3-cms-docker.html">Gut eingepackt: TYPO3 CMS in Docker betreiben</a></strong>
              am 22. März 2019
            </li>
          
        </ul>
      </div>
      <div class="col-sm-4">
        <h5>
          Menü
        </h5>
        <ul>
          
            <li><a href="/de/impressum.html">Impressum</a></li>
          
        </ul>
      </div>
    </div>
  </div>
  <div class="footer-copyright py-3 text-center">
    Martin Helmich 2018
  </div>
</footer>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.13.0/umd/popper.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.5.0/js/mdb.min.js"></script>
<script type="text/javascript">
$("#martin-grumpy").mouseover(function() {
  $(this).attr("src", "/assets/martin-happy.jpg");
});
$("#martin-grumpy").mouseout(function() {
  $(this).attr("src", "/assets/martin-grumpy.jpg");
});
</script>

  </body>

</html>
