<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Source code content elements for TYPO3 Neos</title>
  <meta name="description" content="Of all the features of TYPO3 Neos, one that astonishes me most is the system’s extensibility. For this site, I needed the possibility to present source code ...">

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.9/css/all.css" integrity="sha384-5SOiIsAziJl6AWe0HWRKTXlfcSHKmYV4RBF18PPJ173Kzn7jzMyFuTtk8JA7QQG1" crossorigin="anonymous">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.5.0/css/mdb.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/fonts.css">

  <link rel="canonical" href="https://www.martin-helmich.de/en/blog/source-code-content-in-neos.html">

  <link rel="alternate" type="application/rss+xml" title="martin-helmich.de" href="https://www.martin-helmich.de/feed.xml">

  
    <link rel="alternate" hreflang="de" href="/de/blog/quelltext-content-in-neos.html">
  

</head>


  <body>

    <div class="main">
      <div  class="blog-landing" style="background-image: url(/assets/headers/neos-sourcecode.jpg)">
      <nav class="navbar navbar-expand-lg navbar-dark elegant-color">
  <div class="container">
    <a class="navbar-brand" href="/en/blog.html">martin-helmich.de</a>

    <!-- Collapse button -->
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="basicExampleNav"
        aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse">
      <ul class="navbar-nav mr-auto">
        
          
          
          <li class="nav-item normal">
            <a class="nav-link" href="/en/blog.html">Blog</a>
          </li>
        
          
          
          <li class="nav-item normal">
            <a class="nav-link" href="/en/about-me.html">About me</a>
          </li>
        
          
          
          <li class="nav-item normal">
            <a class="nav-link" href="/en/publications.html">Publications</a>
          </li>
        
      </ul>

      
      <ul class="navbar-nav navbar-right">
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">
            English
            <span class="caret"></span>
          </a>
          <div class="dropdown-menu dropdown-primary">
            <a class="normal dropdown-item" href="/de/blog/quelltext-content-in-neos.html">German</a>
            <a class="active dropdown-item" href="/en/blog/source-code-content-in-neos.html">English</a>
          </div>
        </li>
      </ul>
      
    </div>
  </div>
</nav>


        <div class="container attribution">
          
          CC BY-SA, Martin Helmich
          
        </div>
      </div>

      <div class="container primary">
        <div class="content main-content">
          <div class="post-content">
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <p class="post-meta text-center font-italic">
      Written on
      
      <time datetime="2015-04-13T19:42:28+00:00" itemprop="datePublished">
        13. April 2015
      </time>
      

      
    </p>

    
      <div class="my-alert row info-color-dark white-text z-depth-1">
      <div class="col-sm-12">
        <span class="icon">
          <i class="fa fa-globe"></i>
        </span>
        <div class="my-alert-body">
          <strong>Hallo! </strong> 
        Dieser Artikel steht auch <a href="/de/blog/quelltext-content-in-neos.html">auf Deutsch zur Verfügung</a>!
      
        </div>
      </div>
    </div>
    

    <h1 class="post-title" itemprop="name headline">Source code content elements for TYPO3 Neos</h1>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Of all the features of TYPO3 Neos, one that astonishes me most is the system’s extensibility. For this site, I needed the possibility to present source code examples with syntax highlighting. Luckily, that isn’t any problem at all in Neos. In this article, I describe how you can extend TYPO3 Neos with a custom NodeType that renders a content element with source code and syntax highlighting into your Neos site.</p>

<p>At this point I’m assuming that you know about the TYPO3 Neos basics, and especially know</p>

<ul>
  <li>how the Neos package structures looks like and which files are stored where</li>
  <li>how content is structured in Neos and that there’s something like a Content Repository</li>
  <li>how to create your own Node Types</li>
</ul>

<h2 id="define-node-types">Define Node Types</h2>

<p>Start by defining the corresponding node type. This is done in the configuration file <code class="language-plaintext highlighter-rouge">Configuration/NodeTypes.yaml</code> in your own site package. For my example, I’m using the package key <code class="language-plaintext highlighter-rouge">Helmich.Homepage</code>. When taking over code examples, remember to adjust the package key according to your own needs:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="code"><pre><span class="s1">'</span><span class="s">Helmich.Homepage:SourceCode'</span><span class="pi">:</span>
  <span class="na">superTypes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">TYPO3.Neos:Content'</span>
  <span class="na">ui</span><span class="pi">:</span>
    <span class="na">group</span><span class="pi">:</span> <span class="s">general</span>
    <span class="na">label</span><span class="pi">:</span> <span class="s">Source code</span>
    <span class="na">icon</span><span class="pi">:</span> <span class="s">icon-code</span>
    <span class="na">inspector</span><span class="pi">:</span>
      <span class="na">groups</span><span class="pi">:</span>
        <span class="na">code</span><span class="pi">:</span>
          <span class="na">label</span><span class="pi">:</span> <span class="s">Code</span>
  <span class="na">properties</span><span class="pi">:</span>
    <span class="na">content</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="na">ui</span><span class="pi">:</span>
        <span class="na">label</span><span class="pi">:</span> <span class="s">Code</span>
        <span class="na">reloadIfChanged</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">inspector</span><span class="pi">:</span>
          <span class="na">group</span><span class="pi">:</span> <span class="s">code</span>
          <span class="na">position</span><span class="pi">:</span> <span class="m">80</span>
          <span class="na">editor</span><span class="pi">:</span> <span class="s1">'</span><span class="s">TYPO3.Neos/Inspector/Editors/CodeEditor'</span>
          <span class="na">editorOptions</span><span class="pi">:</span>
            <span class="na">buttonLabel</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Edit</span><span class="nv"> </span><span class="s">source</span><span class="nv"> </span><span class="s">code'</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Unfortunately, we cannot use the inline editing that we already know from Neos. This is because the Aloha editor does not get along with the <code class="language-plaintext highlighter-rouge">&lt;pre&gt;</code> tags that the content will be rendered into later. That’s not a big thing, though, because Neos offers a special code editor just for this case. This editor is activated in the snippet above in line 21. Using this editor, Neos will offer you a fully functional source code editor with syntax highlighting in the backend for editing the source code content.</p>

<h2 id="the-fluid-template">The Fluid Template</h2>

<p>Next, define the Fluid template for the Node Type. This isn’t overly complex, because after all, we simply want to output the source code exactly the same way that it was entered. By default, Neos will look for the template in <code class="language-plaintext highlighter-rouge">Resources/Private/Templates/NodeTypes/SourceCode.html</code>. You could override this convention using TypoScript, but why should you?</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">{namespace neos=TYPO3\Neos\ViewHelpers}
{namespace media=TYPO3\Media\ViewHelpers}

<span class="nt">&lt;pre</span> <span class="na">class=</span><span class="s">"prettyprint"</span><span class="nt">&gt;&lt;code&gt;</span>{node.properties.content}<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span></code></pre></figure>

<p>That’s not too hard, is it? At this point, you can already create source code content elements in the Neos backend. You don’t have syntax highlighting or any other fancy stuff yet, though. That’s what’s next.</p>

<h2 id="configure-syntax-highlighting">Configure syntax highlighting</h2>

<p>For syntax highlighting, I’m using <a href="https://code.google.com/p/google-code-prettify/">Google’s Prettify library</a>. It’s working entirely in JavaScript, which saves you the trouble of processing the source code in your PHP backend. The library consists of some JavaScript and CSS files, which you best put into the <code class="language-plaintext highlighter-rouge">Resources/Public</code> directory of your package (I’m using <code class="language-plaintext highlighter-rouge">Resources/Public/Libraries/Prettify</code> for that).</p>

<p>Now all that’s left is to include the library. The easiest way to do that is using the page template:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
{namespace neos=TYPO3\Neos\ViewHelpers}
{namespace ts=TYPO3\TypoScript\ViewHelpers}
{namespace tbs=TYPO3\Twitter\Bootstrap\ViewHelpers}
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;f:section</span> <span class="na">name=</span><span class="s">"stylesheets"</span><span class="nt">&gt;</span>
        <span class="c">&lt;!-- Put your stylesheet inclusions here, they will be included in your website by TypoScript --&gt;</span>
    <span class="nt">&lt;/f:section&gt;</span>
    <span class="nt">&lt;f:section</span> <span class="na">name=</span><span class="s">"headScripts"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span>
                <span class="na">src=</span><span class="s">"{f:uri.resource(path:'Libraries/Prettify/run_prettify.js', package: 'Helmich.Homepage')}?skin=desert"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/f:section&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="c">&lt;!-- ... --&gt;</span>
</pre></td></tr></tbody></table></code></pre></figure>

<h2 id="more-configuration">More configuration!</h2>

<p>In the last step I’d like to make the content element a bit more configurable. For example, Prettify’s automatical language recognition does not work that well at times, and it would be nice to specify the used programming language in the Neos backend. Another nice feature would be to enable or disable the line numbering in the source code examples.</p>

<p>For both configuration options, you can extend the original node type definition:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td><td class="code"><pre><span class="s1">'</span><span class="s">Helmich.Homepage:SourceCode'</span><span class="pi">:</span>
  <span class="na">superTypes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s1">'</span><span class="s">TYPO3.Neos:Content'</span>
  <span class="na">ui</span><span class="pi">:</span>
    <span class="na">group</span><span class="pi">:</span> <span class="s">general</span>
    <span class="na">label</span><span class="pi">:</span> <span class="s">Source code</span>
    <span class="na">icon</span><span class="pi">:</span> <span class="s">icon-code</span>
    <span class="na">inspector</span><span class="pi">:</span>
      <span class="na">groups</span><span class="pi">:</span>
        <span class="na">code</span><span class="pi">:</span>
          <span class="na">label</span><span class="pi">:</span> <span class="s">Code</span>
  <span class="na">properties</span><span class="pi">:</span>
    <span class="na">content</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="na">ui</span><span class="pi">:</span>
        <span class="na">label</span><span class="pi">:</span> <span class="s">Code</span>
        <span class="na">reloadIfChanged</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">inspector</span><span class="pi">:</span>
          <span class="na">group</span><span class="pi">:</span> <span class="s">code</span>
          <span class="na">position</span><span class="pi">:</span> <span class="m">80</span>
          <span class="na">editor</span><span class="pi">:</span> <span class="s1">'</span><span class="s">TYPO3.Neos/Inspector/Editors/CodeEditor'</span>
          <span class="na">editorOptions</span><span class="pi">:</span>
            <span class="na">buttonLabel</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Edit</span><span class="nv"> </span><span class="s">source</span><span class="nv"> </span><span class="s">code'</span>
    <span class="na">lineNumbers</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
      <span class="na">defaultValue</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">ui</span><span class="pi">:</span>
        <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Enable</span><span class="nv"> </span><span class="s">line</span><span class="nv"> </span><span class="s">numbering'</span>
        <span class="na">reloadIfChanged</span><span class="pi">:</span> <span class="s">TRUE</span>
        <span class="na">inspector</span><span class="pi">:</span>
          <span class="na">group</span><span class="pi">:</span> <span class="s1">'</span><span class="s">code'</span>
          <span class="na">position</span><span class="pi">:</span> <span class="m">60</span>
    <span class="na">language</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
      <span class="na">defaultValue</span><span class="pi">:</span> <span class="s1">'</span><span class="s">auto'</span>
      <span class="na">ui</span><span class="pi">:</span>
        <span class="na">reloadIfChanged</span><span class="pi">:</span> <span class="s">TRUE</span>
        <span class="na">inspector</span><span class="pi">:</span>
          <span class="na">group</span><span class="pi">:</span> <span class="s">code</span>
          <span class="na">position</span><span class="pi">:</span> <span class="m">50</span>
          <span class="na">editor</span><span class="pi">:</span> <span class="s1">'</span><span class="s">TYPO3.Neos/Inspector/Editors/SelectBoxEditor'</span>
          <span class="na">editorOptions</span><span class="pi">:</span>
            <span class="na">values</span><span class="pi">:</span>
              <span class="s1">'</span><span class="s">auto'</span><span class="pi">:</span>
                <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Determine</span><span class="nv"> </span><span class="s">automatically'</span>
              <span class="s1">'</span><span class="s">html'</span><span class="pi">:</span>
                <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">HTML'</span>
              <span class="s1">'</span><span class="s">php'</span><span class="pi">:</span>
                <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">PHP'</span>
              <span class="s1">'</span><span class="s">xml'</span><span class="pi">:</span>
                <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">XML'</span>
              <span class="s1">'</span><span class="s">yaml'</span><span class="pi">:</span>
                <span class="na">label</span><span class="pi">:</span> <span class="s1">'</span><span class="s">YAML'</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>Evaluating these options is best done in TypoScript. The standard point of entry is the file <code class="language-plaintext highlighter-rouge">Root.ts2</code>, which Neos will look for in <code class="language-plaintext highlighter-rouge">Resources/Private/TypoScript</code>:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>prototype(Helmich.Homepage:SourceCode) {
  attributes.class = 'prettyprint'
  attributes.class.@process {
    language {
      expression = ${value + (q(node).property('language') != 'auto' ? ' lang-' + q(node).property('language') : '')}
    }

    lineNumbering {
      expression = ${value + (q(node).property('lineNumbers') ? ' linenums' : '')}
    }
  }
}
</pre></td></tr></tbody></table></code></pre></figure>

<p>In order to use the attributes configured in TypoScript in your template, you’ll need to adjust the Fluid template:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre>{namespace neos=TYPO3\Neos\ViewHelpers}
{namespace media=TYPO3\Media\ViewHelpers}

<span class="nt">&lt;pre</span> <span class="err">{</span><span class="na">attributes</span> <span class="na">-</span><span class="nt">&gt;</span> f:format.raw()}&gt;<span class="nt">&lt;code&gt;</span>{node.properties.content}<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</pre></td></tr></tbody></table></code></pre></figure>


  </div>

  <h2 id="comments">Comments</h2>

  <div id="disqus_thread"  class="helmich-homepage-blogarticle"></div>
</article>
<script type="text/javascript">
var disqus_config = function () {
    this.page.url = "https://www.martin-helmich.de/en/blog/source-code-content-in-neos.html";
    this.page.identifier = "0b5a5243-9c0e-b5dd-c9ce-80da73c3f781";
    this.page.title = "Source code content elements for TYPO3 Neos";
};

(function() {  // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    
    s.src = 'https://martinhelmichde.disqus.com/embed.js';
    
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script>
<noscript>
Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments
powered by Disqus.</a>
</noscript>
</div>
        </div>
      </div>
    </div>

    

<footer class="page-footer font-small stylish-color pt-4 z-depth-1">
  <div class="container">
    <div class="row">
      <div class="col-sm-4">
        <h5>Publications</h5>
        <ul>
          
          
            <li>
              <strong><a href="/en/publications.html">Praxiswissen TYPO3 CMS 10</a></strong>
              am 04. Dezember 2020
            </li>
          
            <li>
              <strong><a href="/en/publications.html">Rust: Ein Blick auf die C/C++-Alternative</a></strong>
              am 01. Juli 2020
            </li>
          
            <li>
              <strong><a href="/en/publications.html">Microservices: Mit Tools wie Jaeger die Übersicht behalten</a></strong>
              am 01. April 2020
            </li>
          
            <li>
              <strong><a href="/en/publications.html">Kommunikation zwischen Browser & Server: Mit Publish/Subscribe mehr Komplexität abbilden</a></strong>
              am 28. August 2019
            </li>
          
            <li>
              <strong><a href="/en/publications.html">Automatisierung mit Kubernetes Operators</a></strong>
              am 01. Mai 2019
            </li>
          
        </ul>
      </div>
      <div class="col-sm-4">
        <h5>
          Blog articles
        </h5>
        <ul>
          
          
            <li>
              <strong><a href="/https:/t3n.de/magazin/event-sourcing-das-steckt-hinter-250347/">Event Sourcing: How the "software ledger" works
</a></strong>
              am 14. Februar 2021
            </li>
          
            <li>
              <strong><a href="/https:/t3n.de/magazin/microservices-mit-tools-wie-die-249408/">Microservices: Keeping track of things with Jaeger</a></strong>
              am 04. Juli 2020
            </li>
          
            <li>
              <strong><a href="/en/blog/typo3-cms-docker.html">Well contained: Running TYPO3 in Docker</a></strong>
              am 03. Mai 2020
            </li>
          
            <li>
              <strong><a href="/en/blog/kubernetes-crd-client.html">Accessing Kubernetes CRDs from the client-go package</a></strong>
              am 15. April 2020
            </li>
          
            <li>
              <strong><a href="/https:/jaxenter.de/kubernetes/automatisierung-kubernetes-operators-88189">Automation with Kubernetes operators</a></strong>
              am 04. Februar 2020
            </li>
          
        </ul>
      </div>
      <div class="col-sm-4">
        <h5>
          Menu
        </h5>
        <ul>
          
            <li><a href="/de/impressum.html">Legal</a></li>
          
        </ul>
      </div>
    </div>
  </div>
  <div class="footer-copyright py-3 text-center">
    Martin Helmich 2018
  </div>
</footer>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.13.0/umd/popper.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.5.0/js/mdb.min.js"></script>
<script type="text/javascript">
$("#martin-grumpy").mouseover(function() {
  $(this).attr("src", "/assets/martin-happy.jpg");
});
$("#martin-grumpy").mouseout(function() {
  $(this).attr("src", "/assets/martin-grumpy.jpg");
});
</script>

  </body>

</html>
